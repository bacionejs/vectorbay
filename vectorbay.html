<meta name="viewport" content="width=device-width"> <script> onload=()=>{

let {sqrt,PI,floor,round}=Math;
let save,text,C,W,grid,offset,points,dragTarget,highlightedIndex;
init();

function init(){
initStyle();
save=element("button"); save.onclick=exportHTML;
text=element("div"); text.contentEditable=true;
let canvas=element("canvas"); C=canvas.getContext("2d");
W,grid=20,offset=grid/2,points=[],dragTarget=null,highlightedIndex=-1;
canvas.addEventListener("pointerdown", handleDown);
text.addEventListener("input", handleTextInput);
document.addEventListener("selectionchange", () => { if(document.activeElement===text) updateHighlight(); });
W=innerWidth<innerHeight?innerWidth:innerHeight*0.8;
W=floor(W/grid)*grid; 
canvas.width=canvas.height=W;
draw(); 
}











function draw(shouldUpdateText=true){
let s=W/grid,mid=W/2;
C.clearRect(0,0,W,W);
C.strokeStyle="#222";C.lineWidth=1;C.beginPath();
for(let i=0;i<=grid;i++){ C.moveTo(i*s,0);C.lineTo(i*s,W); C.moveTo(0,i*s);C.lineTo(W,i*s); } C.stroke();
C.strokeStyle="#ff4444";C.lineWidth=1;C.beginPath(); C.moveTo(0,mid);C.lineTo(W,mid); C.moveTo(mid,0);C.lineTo(mid,W); C.stroke();
if(points.length===0)return;
C.save();C.translate(mid,mid);
[1,-1].forEach(m=>{
  C.beginPath();
  C.moveTo(m*(points[0].x-offset)*s,(points[0].y-offset)*s);
  for(let i=1;i<points.length;i++){
    let p=points[i];
    C.bezierCurveTo(
      m*(p.cp1x-offset)*s,(p.cp1y-offset)*s,
      m*(p.cp2x-offset)*s,(p.cp2y-offset)*s,
      m*(p.x-offset)*s,(p.y-offset)*s
    );
  }
  C.strokeStyle="#00bfff";C.lineWidth=3;C.stroke();
  if(round(points[0].x)===offset&&round(points[points.length-1].x)===offset){
    C.fillStyle="rgba(0, 191, 255, 0.2)";
    C.fill();
  }
});
C.restore();
points.forEach((p,i)=>{
  let isHighlighted=(i===highlightedIndex);
  if(isHighlighted){
    C.shadowBlur=15;
    C.shadowColor="white";
    circle(p.x*s,p.y*s,10,"rgba(255,255,255,0.5)");
  }
  circle(p.x*s,p.y*s,6,"#ff4444");
  C.shadowBlur=0;
  if(i>0){
    circle(p.cp1x*s,p.cp1y*s,4,"#00ff00");
    circle(p.cp2x*s,p.cp2y*s,4,"#00ff00");
    C.setLineDash([4,4]);C.strokeStyle="#666";C.beginPath();
    C.moveTo(points[i-1].x*s,points[i-1].y*s);C.lineTo(p.cp1x*s,p.cp1y*s);
    C.moveTo(p.x*s,p.y*s);C.lineTo(p.cp2x*s,p.cp2y*s);C.stroke();C.setLineDash([]);
  }
});

if(shouldUpdateText)updateText();
}//











function addPoint(x,y){
if(points.length===0){
  points.push({x,y});
}else{
  let prev=points[points.length-1];
  points.push({
    x,y,
    cp1x:round(prev.x+(x-prev.x)/3),
    cp1y:round(prev.y+(y-prev.y)/3),
    cp2x:round(prev.x+(x-prev.x)*2/3),
    cp2y:round(prev.y+(y-prev.y)*2/3)
  });
}
draw();
}

function updateHighlight(){
let selection=window.getSelection();
if(!selection||!selection.rangeCount)return;
let textBefore=text.textContent.substring(0,selection.getRangeAt(0).startOffset);
let matches=textBefore.match(/\[/g);
highlightedIndex=matches?matches.length-2:-1;
draw(false);
}

function handleTextInput(){
try{
  let p=[]; let data=JSON.parse(text.textContent.trim());
  data.forEach((arr,i)=>{
    if(i===0){
      p.push({x:arr[0]+offset,y:arr[1]+offset});
    }else{
      p.push({
        cp1x:arr[0]+offset,cp1y:arr[1]+offset,
        cp2x:arr[2]+offset,cp2y:arr[3]+offset,
        x:arr[4]+offset,y:arr[5]+offset
      });
    }
  });
  points=p;
  updateHighlight();
}catch(e){}
}

function updateText(){
let t=n=>(n-offset);
let lines=points.map((p,i)=>
  i===0
    ?"["+t(p.x)+","+t(p.y)+"]"
    :"["+t(p.cp1x)+","+t(p.cp1y)+","+t(p.cp2x)+","+t(p.cp2y)+","+t(p.x)+","+t(p.y)+"]"
);
text.textContent="["+lines.join(",")+"]";
}

function handleMove(e){
if(!dragTarget)return;
let rect=C.canvas.getBoundingClientRect(),s=W/grid;
let mx=round((e.clientX-rect.left)/s),my=round((e.clientY-rect.top)/s);
let p=points[dragTarget.i];
if(dragTarget.type==="anchor"){p.x=mx;p.y=my;}
else if(dragTarget.type==="cp1"){p.cp1x=mx;p.cp1y=my;}
else if(dragTarget.type==="cp2"){p.cp2x=mx;p.cp2y=my;}
draw();
}

function handleDown(e){
window.addEventListener("pointermove", handleMove);
window.addEventListener("pointerup", handleUp);
window.addEventListener("pointercancel", handleUp);
let rect=C.canvas.getBoundingClientRect(),s=W/grid;
let mx=(e.clientX-rect.left)/s,my=(e.clientY-rect.top)/s,hit=0.6;
for(let i=0;i<points.length;i++){
  let p=points[i];
  if(dist(mx,my,p.x,p.y)<hit){dragTarget={i,type:"anchor"};return;}
  if(i>0){
    if(dist(mx,my,p.cp1x,p.cp1y)<hit){dragTarget={i,type:"cp1"};return;}
    if(dist(mx,my,p.cp2x,p.cp2y)<hit){dragTarget={i,type:"cp2"};return;}
  }
}
addPoint(round(mx),round(my));
}

function handleUp(){
dragTarget=null;
window.removeEventListener("pointermove", handleMove);
window.removeEventListener("pointerup", handleUp);
window.removeEventListener("pointercancel", handleUp);
}











function element(tag){let e=document.createElement(tag);document.body.appendChild(e);return e;}
function circle(x,y,r,color){C.fillStyle=color;C.beginPath();C.arc(x,y,r,0,PI*2);C.fill();}
function dist(x1,y1,x2,y2){return sqrt((x1-x2)**2+(y1-y2)**2);}

function initStyle(){
element("style").textContent=`*{margin:0;padding:0;box-sizing:border-box;user-select:none;touch-action:none;} div{ margin:5px; height:7.5em; overflow-y:auto; user-select:text; touch-action:pan-y; background:#1a1a1a; color:#00ff00; font-family:monospace; padding:8px; outline:none; font-size:10px;} button{ margin:5px; padding:5px; cursor:pointer; background:#444; color:white; border:none; border-radius:3px;} button::before{content:'Export';} canvas { display: block; margin: auto; background:#000; cursor: crosshair; } body{ background: #222; 
}`;
}

function exportHTML(){
if(points.length<2)return;
let h="";
h+="<body style='background:#000;display:flex;justify-content:center;align-items:center;height:100vh;margin:0'>";
h+="<script>";
h+="let canvas=document.body.appendChild(document.createElement('canvas'));";
h+="canvas.width=canvas.height=600;";
h+="let c=canvas.getContext('2d'),p="+text.textContent+";";
h+="c.translate(300,300);c.scale(25,25);";
h+="function shape(c,p){";
h+="c.fillStyle='#00bfff';c.beginPath();";
h+="for(let m of [1,-1]){";
h+="c.moveTo(m*p[0][0],p[0][1]);";
h+="for(let i=1;i<p.length;i++)";
h+="c.bezierCurveTo(m*p[i][0],p[i][1],m*p[i][2],p[i][3],m*p[i][4],p[i][5]);";
h+="}";
h+="c.fill();";
h+="}";
h+="shape(c,p);";
h+="</script></body>";
let b=new Blob([h],{type:"text/html"}),a=document.createElement("a");
a.href=URL.createObjectURL(b);a.download="shape.html";a.click();
}

}
</script>
